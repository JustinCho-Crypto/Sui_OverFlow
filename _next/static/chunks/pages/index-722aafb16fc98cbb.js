(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2388:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var a=s(7876),r=s(4232),n=s(8382),l=s(6322),o=s(4587),d=s.n(o);let i="0x50ede43d1e9acfd7df19a011ff15f96f0c184358842161f5977b13630d3e02d2",c=[{name:"Little Stars Home",address:"0x403e9aaf5fecbd8740248b37d792fcab923ee18469a0736a49e9c2f2b5d09789",image:"/images/category-1.png"},{name:"Bright Horizons Orphanage",address:"0xea92245108b9d62c3b44669eb59f04b546e73ae689ac6753c5240eeb07a4d6be",image:"/images/category-2.png"},{name:"Hope Haven",address:"0xea92245108b9d62c3b44669eb59f04b546e73ae689ac6753c5240eeb07a4d6be",image:"/images/category-3.png"}],u=[1,5,10,20],m=[3,6,12];function p(){let e=(0,n.YL)(),{mutate:t,isPending:s}=(0,n.Fp)(),[o,p]=(0,r.useState)(null),[x,b]=(0,r.useState)(null),[h,g]=(0,r.useState)(null),[f,y]=(0,r.useState)(""),[j,v]=(0,r.useState)(null),[w,N]=(0,r.useState)(""),[S,C]=(0,r.useState)(""),[D,_]=(0,r.useState)(""),k=null!=j?j:parseFloat(w),E=Math.round(1e9*k),T="monthly"===x?null!=h?h:parseInt(f):1,A=Math.round(E*T*1.05),F=Math.round(E*T),I=async()=>{if(!e||isNaN(k)||k<=0)return void C("Please connect your wallet and select an amount.");C("Preparing transaction...");try{let s=e.address,a=new l.Z,[r]=a.splitCoins(a.gas,[a.pure.u64(A)]);a.moveCall({target:i+"::vault::create_vault",arguments:[a.pure.address("0xbb645f5ba1c4be44b2698b06c8e5adf3adfa07d544d886314c26fb06b02ff267"),a.pure.address(s),a.pure.address((null==o?void 0:o.address)||""),r,a.pure.u64(E),a.pure.u64(T),a.object("0x6")]}),a.moveCall({target:i+"::nft::generate_and_transfer_nft",arguments:[a.pure.address(s),a.pure.address(s),a.pure.address((null==o?void 0:o.address)||""),a.pure.string("Charui"),a.pure.string("Charity-Walrus-Sui"),a.pure.string(D.trim()||"none"),a.pure.u64(F),a.pure.u64(T),a.pure.u64(Date.now()),a.pure.string("https://ipfs.io/ipfs/bafybeie6ulrzcnnuwx463xljdwvg6fqm5surokcuw4itxai7qa5uh4kmky")]}),a.moveCall({target:i+"::nft::generate_and_transfer_nft_to_recipient",arguments:[a.pure.address((null==o?void 0:o.address)||""),a.pure.address(s),a.pure.address((null==o?void 0:o.address)||""),a.pure.string("Charui"),a.pure.string("Charity-Walrus-Sui"),a.pure.string(D.trim()||"none"),a.pure.u64(F),a.pure.u64(T),a.pure.u64(Date.now()),a.pure.string("https://ipfs.io/ipfs/bafybeie6ulrzcnnuwx463xljdwvg6fqm5surokcuw4itxai7qa5uh4kmky")]}),await t({transaction:a},{onSuccess:e=>C("Donate success! View transaction: "+'<a href="https://suiscan.xyz/testnet/tx/'.concat(e.digest,'" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">').concat(e.digest,"</a>")),onError:e=>C("Error occured: "+e.message)})}catch(e){C("Error occured: "+e.message)}};return(0,a.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Charui, Proof of Charity"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:c.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 rounded-xl shadow-lg text-center cursor-pointer transition-all duration-300 hover:shadow-xl bg-gradient-to-br from-blue-100 to-blue-200 ".concat((null==o?void 0:o.name)===e.name?"ring-2 ring-blue-400":""),onClick:()=>p(e),children:[(0,a.jsx)(d(),{src:e.image,alt:e.name,width:140,height:140,quality:100,className:"mx-auto mb-2"}),(0,a.jsx)("div",{className:"text-md font-semibold text-blue-900",children:e.name})]},e.name))}),o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-gray-100",children:[(0,a.jsx)("h2",{className:"font-semibold mb-2",children:"Select Donation Type"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>b("temporary"),className:"px-4 py-2 rounded ".concat("temporary"===x?"bg-blue-300 text-white":"bg-white border border-gray-300"),children:"One Time"}),(0,a.jsx)("button",{onClick:()=>b("monthly"),className:"px-4 py-2 rounded ".concat("monthly"===x?"bg-blue-300 text-white":"bg-white border border-gray-300"),children:"Monthly"})]})]}),"monthly"===x&&(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-gray-100",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"Select Duration (months)"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[m.map(e=>(0,a.jsxs)("button",{onClick:()=>g(e),className:"px-3 py-2 rounded ".concat(h===e?"bg-blue-400 text-white":"bg-white border border-gray-300"),children:[e," months"]},e)),(0,a.jsx)("input",{type:"number",placeholder:"Custom",className:"w-24 px-3 py-2 border rounded",value:f,onChange:e=>{y(e.target.value),g(null)}})]})]}),(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-gray-100",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"monthly"===x?"Select Amount (per month)":"Select Amount"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[u.map(e=>(0,a.jsxs)("button",{onClick:()=>v(e),className:"px-4 py-2 rounded ".concat(j===e?"bg-blue-400 text-white":"bg-white border border-gray-300"),children:[e," SUI"]},e)),(0,a.jsx)("input",{type:"number",placeholder:"Custom",className:"w-24 px-3 py-2 border rounded",value:w,onChange:e=>{N(e.target.value),v(null)}})]})]}),(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-gray-100",children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"(Optional) The name you want to show to recipient"}),(0,a.jsx)("input",{type:"text",value:D,onChange:e=>_(e.target.value),placeholder:"e.g. Alice, Bob, etc",className:"w-full px-3 py-2 border rounded"})]}),(0,a.jsx)("button",{disabled:!k||!x||s,onClick:I,className:"w-full py-3 bg-blue-600 text-white rounded disabled:opacity-50",children:s?"Donating...":!k||k<=0?"Please select donation type and amount":"Donate ".concat((A/1e9).toFixed(2)," SUI (").concat(T," months)")}),S&&(0,a.jsx)("p",{className:"mt-4 text-center text-gray-700",dangerouslySetInnerHTML:{__html:S}})]})]})}function x(){let e=(0,n.eW)(),t=(0,n.YL)(),[s,l]=(0,r.useState)([]),[o,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(null==t?void 0:t.address){d(!0),u(null);try{let s=(await e.getOwnedObjects({owner:t.address,filter:{StructType:"".concat(i,"::blobregistry::BlobInfo")},options:{showContent:!0}})).data||[];console.log("✅ blobs:",s);let a=s.map(e=>{var t,s,a,r,n,l;let o=null==(a=e.data)||null==(s=a.content)||null==(t=s.fields)?void 0:t.blob_id,d=null==(l=e.data)||null==(n=l.content)||null==(r=n.fields)?void 0:r.to_address;if(!o||!Array.isArray(o))throw Error("Cannot find Blob ID");let i=new TextDecoder().decode(new Uint8Array(o));return console.log("✅ blobIdString:",i),{url:"".concat("https://agg.test.walrus.eosusa.io/v1/blobs","/").concat(i),toAddress:d}});l(a)}catch(e){console.error("❌ BlobInfo fetch failed:",e),u(e.message||"Unknown error")}finally{d(!1)}}})()},[null==t?void 0:t.address]);let m=e=>{window.confirm("Do you want to download this file?")&&window.open(e,"_blank","noopener,noreferrer")};return o?(0,a.jsx)("p",{children:"⏳ Preparing downloads..."}):c?(0,a.jsxs)("p",{className:"text-red-500",children:["❌ ",c]}):0===s.length?(0,a.jsx)("p",{children:"\uD83D\uDE22 No uploaded files"}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:s.map((e,t)=>{let{url:s,toAddress:r}=e;return(0,a.jsxs)("div",{className:"relative w-full max-w-md mx-auto group",children:[(0,a.jsxs)("button",{onClick:()=>m(s),className:"w-full max-w-md mx-auto px-5 py-3 bg-violet-200 text-violet-900 rounded-lg shadow hover:bg-violet-300 transition-all text-sm font-semibold text-center",children:["\uD83D\uDCE5 Proof-of-Charity ",t+1]}),(0,a.jsxs)("div",{className:"absolute left-1/2 bottom-full mb-1 -translate-x-1/2 w-full max-w-md px-3 py-1 bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity text-center",children:["Submitted from: ",r.slice(0,4),"...",r.slice(-4)]})]},t)})})}let b="".concat(i,"::nft::DonationNFT");function h(){let e=(0,n.YL)(),t=(0,n.eW)(),[s,l]=(0,r.useState)(0),[o,d]=(0,r.useState)(0),[c,u]=(0,r.useState)([]),[m,p]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async()=>{if(null==e?void 0:e.address)try{let s=(await t.getOwnedObjects({owner:e.address,filter:{StructType:b},options:{showContent:!0}})).data.filter(t=>{var s,a,r;return(null==(r=t.data)||null==(a=r.content)||null==(s=a.fields)?void 0:s.from_address)===e.address});u(s);let a=s.reduce((e,t)=>{var s,a,r;return e+Number((null==(r=t.data)||null==(a=r.content)||null==(s=a.fields)?void 0:s.amount)||0)},0);d(s.length),l(a/1e9)}catch(e){console.error("Failed to fetch donations",e)}})()},[null==e?void 0:e.address]),(0,r.useEffect)(()=>{(async()=>{if(null==e?void 0:e.address)try{let s=(await t.getOwnedObjects({owner:e.address,filter:{StructType:"".concat(i,"::blobregistry::BlobInfo")},options:{showContent:!0}})).data.map(e=>{var t,s,a,r,n,l,o,d,i;return{fromAddress:null==(a=e.data)||null==(s=a.content)||null==(t=s.fields)?void 0:t.from_address,toAddress:null==(l=e.data)||null==(n=l.content)||null==(r=n.fields)?void 0:r.to_address,objectId:null==(i=e.data)||null==(d=i.content)||null==(o=d.fields)?void 0:o.object_id}}).filter(e=>e.fromAddress&&e.toAddress&&e.objectId);console.log(s),p(s)}catch(e){console.error("Failed to fetch uploaded blob bindings",e)}})()},[null==e?void 0:e.address]),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-start min-h-screen bg-white p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"My Profile"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Total Donations: ",s.toFixed(2)," SUI"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Thanks to you, ",o," lives have been saved."]}),(0,a.jsx)("h2",{className:"text-md font-semibold mb-2",children:"Thank you for choosing to Donate with Charui."}),(0,a.jsxs)("div",{className:"w-full max-w-2xl border border-gray-200 rounded-lg p-6 mt-6 shadow-sm bg-gray-50",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsxs)("div",{className:"font-medium",children:["[Proof of Charity] Donation at"," ",new Date().toLocaleDateString("en-GB").replace(/\//g,".")," to recipients"]})}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:c.map((e,t)=>{var s,a,r,n,l,o;let d=null==(r=e.data)||null==(a=r.content)||null==(s=a.fields)?void 0:s.from_address,i=null==(o=e.data)||null==(l=o.content)||null==(n=l.fields)?void 0:n.to_address;if(!m.find(e=>e.fromAddress===d&&e.toAddress===i))return null})}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h3",{className:"text-md font-semibold mb-2",children:"Submitted Proofs"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,a.jsx)(x,{})})]})]})]})}var g=s(236);function f(e){let{fromAddress:t}=e,s=(0,n.YL)(),{mutateAsync:o}=(0,n.wL)(),{mutateAsync:d}=(0,n.Fp)();(0,n.eW)();let[c,u]=(0,r.useState)(null),[m,p]=(0,r.useState)(""),x=async()=>{if(!s||!c||!t)return void p("Wallet connection, file selection, and target address are required.");try{p("\uD83D\uDCE6 Signing file...");let e=await c.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",e),r=new Uint8Array(a),n=btoa(String.fromCharCode(...r)),u="I agree to upload a file to Walrus.\n  \n      File name: ".concat(c.name,"\n      File hash (base64): ").concat(n,"\n      Timestamp: ").concat(new Date().toISOString()),m=(await o({message:new TextEncoder().encode(u)})).signature;if(!m)throw Error("Failed to sign");p("\uD83D\uDE80 Uploading...");let x=new FormData;x.append("file",c),x.append("signature",m),x.append("signer",s.address);let b=await fetch("/api/upload",{method:"POST",body:x});console.log("res.status:",b.status);let h=await b.json();console.log("Frontend received json:",h);let{objectId:g,blobId:f}=h;if(!g||!f)throw Error("Cannot find Object ID or Blob ID");p("\uD83D\uDCAB Successfully Uploaded on walrus! Please sign the next transaction to register the blob.");let y=new l.Z,j=new TextEncoder().encode(f),v=Array.from(j);y.setSender(s.address),y.moveCall({target:"".concat(i,"::blobregistry::register_blob"),arguments:[y.pure.address(t),y.pure.address(s.address),y.pure.address(g),y.pure.vector("u8",v)]});let w=await d({transaction:y},{onSuccess:e=>p("✅ Upload and registration complete!<br /> View object: "+'<a href="https://suiscan.xyz/testnet/object/'.concat(g,'/tx-blocks" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">').concat(g,"</a>")+"<br /> View transaction: "+'<a href="https://suiscan.xyz/testnet/tx/'.concat(e.digest,'" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">').concat(e.digest,"</a>")),onError:e=>p("❌ Error occured: "+e.message)});console.log("✅ register_blob transaction success:",w.digest)}catch(e){console.error("❌ Error occurred:",e),p("❌ Error occurred: "+e.message)}},{getRootProps:b,getInputProps:h}=(0,g.VB)({onDrop:e=>{e.length>0&&u(e[0])}});return(0,a.jsxs)("div",{className:"flex flex-col items-center p-8",children:[(0,a.jsx)("h1",{className:"text-xl font-bold mt-4",children:"Walrus Upload"}),(0,a.jsxs)("div",{...b(),className:"mt-4 border-dashed border-2 border-gray-400 p-6 w-96 text-center cursor-pointer",children:[(0,a.jsx)("input",{...h()}),c?(0,a.jsx)("p",{children:c.name}):(0,a.jsx)("p",{children:"Drag and drop or click to upload a file"})]}),(0,a.jsx)("button",{onClick:x,className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded",children:"Upload"}),m&&(0,a.jsx)("p",{className:"mt-4 text-center text-gray-700",dangerouslySetInnerHTML:{__html:m}})]})}let y=new(s(4866)).x({url:"https://fullnode.testnet.sui.io:443"}),j="".concat(i,"::nft::DonationNFT");function v(){let e=(0,n.YL)(),[t,s]=(0,r.useState)(!0),[l,o]=(0,r.useState)([]),[d,i]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{if(null==e?void 0:e.address){s(!0);try{let t=(await y.getOwnedObjects({owner:e.address,filter:{StructType:j},options:{showContent:!0}})).data.map((e,t)=>{var s,a;let r=null==(a=e.data)||null==(s=a.content)?void 0:s.fields,n=(null==r?void 0:r.sponsor_name)||"none",l=null==r?void 0:r.from_address;return{name:"none"===n?"Sponsor ".concat(t+1):n,address:l}}),s=Array.from(new Map(t.map(e=>[e.address,e])).values());o(s)}catch(e){console.error("NFT 조회 실패:",e)}finally{s(!1)}}})()},[e]),e)?t?(0,a.jsx)("p",{className:"p-4",children:"\uD83D\uDD0D Checking NFT ownership..."}):l.length?(0,a.jsx)("div",{className:"p-6",children:d?d&&(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{onClick:()=>i(null),className:"mb-4 text-sm text-blue-600 underline",children:"← Other Sponsors"}),(0,a.jsx)(f,{fromAddress:d.address})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-center text-2xl mb-4",children:"Select Sponsor"}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:l.map(e=>(0,a.jsx)("button",{onClick:()=>i(e),className:"px-6 py-3 rounded-xl bg-gradient-to-br from-blue-100 to-blue-200 hover:from-blue-200 hover:to-blue-300 shadow-sm text-sm font-medium text-blue-800 text-center",children:e.name},e.address))})})]})}):(0,a.jsx)("p",{className:"p-4 text-red-500",children:"❌ No accessible NFTs."}):(0,a.jsx)("p",{className:"p-4",children:"Wallet connection is required."})}function w(){let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),o=(0,n.YL)();(0,r.useEffect)(()=>{o&&s&&t("sponsor"===s?"donate":"upload")},[o,s]);let d=e=>"px-4 py-2 rounded-md text-sm font-semibold transition \n     ".concat(e?"bg-blue-100 text-blue-800 ring-2 ring-blue-400":"bg-gray-100 text-gray-600 hover:bg-gray-200");return(0,a.jsx)("div",{className:"h-screen flex flex-col bg-blue-50",children:o||e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-center items-start px-6 py-4 border-b border-gray-300 bg-white shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full max-w-6xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-8",children:["recipient"===s&&(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("button",{onClick:()=>t("upload"),className:d("upload"===e),children:"⏫ Upload"})}),"sponsor"===s&&(0,a.jsx)("div",{className:"flex items-start gap-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>t("donate"),className:d("donate"===e),children:"\uD83C\uDF81 Donate"}),(0,a.jsx)("button",{onClick:()=>t("profile"),className:d("profile"===e),children:"\uD83D\uDCC4 My Profile"})]})})]}),(0,a.jsx)(n.pK,{})]})}),(0,a.jsxs)("div",{className:"p-6",children:["donate"===e&&(0,a.jsx)(p,{}),"profile"===e&&(0,a.jsx)(h,{}),"upload"===e&&(0,a.jsx)(v,{})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center flex-grow gap-4",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-4 mt-8 relative z-10",children:"Charui, Proof of Charity"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-700",children:"Choose your role \uD83D\uDC47"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>l("sponsor"),className:"px-6 py-3 rounded-lg font-semibold ".concat("sponsor"===s?"bg-blue-200":"bg-white"),children:"\uD83C\uDF81 Sponsor"}),(0,a.jsx)("button",{onClick:()=>l("recipient"),className:"px-6 py-3 rounded-lg font-semibold ".concat("recipient"===s?"bg-blue-200":"bg-white"),children:"\uD83D\uDCE6 Recipient"})]}),s&&(0,a.jsx)("div",{className:"relative z-10",children:(0,a.jsx)(n.pK,{})})]})})}},6760:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(2388)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[402,636,593,792],()=>t(6760)),_N_E=e.O()}]);